---
const { to = 1000, label = "Metric", suffix = "" } = Astro.props;
const id = `stat-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="stat card">
  <div class="num" id={id}>0</div>
  <div class="lbl">{label}</div>
</div>

<script define:vars={{ id, to, suffix }}>
  const el = document.getElementById(id);

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const t0 = performance.now();
        const dur = 1500;

        function tick(t) {
          const p = Math.min(1, (t - t0) / dur);
          const eased = 1 - Math.pow(1 - p, 3);
          const val = Math.round(to * eased);
          el.textContent = val.toLocaleString() + suffix;

          if (p < 1) {
            requestAnimationFrame(tick);
          }
        }

        requestAnimationFrame(tick);
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.3 });

  observer.observe(el);
</script>

<style>
  .stat {
    padding: 32px 24px;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .stat:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 48px rgba(231, 76, 60, 0.15);
  }

  .num {
    font-size: 2.5rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--white), var(--brand-red));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 8px;
  }

  .lbl {
    color: var(--muted);
    font-size: 0.9rem;
    font-weight: 500;
  }

  @media (prefers-reduced-motion: reduce) {
    .stat {
      transition: none;
    }
  }
</style>
