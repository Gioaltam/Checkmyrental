---
import { ViewTransitions } from "astro:transitions";
import AccessibilityHelpers from "../components/AccessibilityHelpers.astro";

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  ogType?: string;
}

const {
  title = "Quarterly Maintenance Property Inspections | 24â€‘Hour Reports | CheckMyRental",
  description = "Professional rental property inspections with photoâ€‘rich 24â€‘hour reports. Our signature Quarterly Maintenance Inspections help you catch issues early and protect your investment.",
  ogImage = "/og-image.jpg", // Default Open Graph image
  ogType = "website"
} = Astro.props;

// Get current URL for canonical and og:url
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const ogImageURL = new URL(ogImage, Astro.site);
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="view-transition" content="same-origin">

  <!-- Primary Meta Tags -->
  <title>{title}</title>
  <meta name="title" content={title}>
  <meta name="description" content={description}>
  <meta name="keywords" content="property inspection, rental inspection, quarterly maintenance, HVAC inspection, move-in inspection, move-out inspection, Tampa Bay, St Petersburg, Clearwater, Florida">
  <link rel="canonical" href={canonicalURL}>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={ogType}>
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={ogImageURL}>
  <meta property="og:site_name" content="CheckMyRental">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content={canonicalURL}>
  <meta property="twitter:title" content={title}>
  <meta property="twitter:description" content={description}>
  <meta property="twitter:image" content={ogImageURL}>

  <!-- Favicon and App Icons -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0a0a0f">

  <!-- Preconnect to external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Preload critical fonts -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"></noscript>

  <link rel="stylesheet" href="/static/view-transitions.css">

  <!-- Analytics (Google Tag Manager) -->
  <script is:inline>
    // Google Tag Manager will be injected here
    if (typeof window.dataLayer !== 'undefined') {
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer',import.meta.env.PUBLIC_GTM_ID || '');
    }
  </script>

  <ViewTransitions />
</head>
<body>
  <AccessibilityHelpers />

  <!-- Logo Entrance Animation -->
  <div class="entrance-curtain" id="entrance-curtain">
    <!-- Scanning Grid Overlay -->
    <div class="scan-grid"></div>

    <!-- Horizontal Scan Line -->
    <div class="scan-line">
      <div class="scan-dot"></div>
    </div>

    <!-- Energy Waves -->
    <div class="energy-wave wave-1"></div>
    <div class="energy-wave wave-2"></div>
    <div class="energy-wave wave-3"></div>

    <div class="entrance-logo-container">
      <div class="entrance-logo">
        <!-- Holographic Ring -->
        <div class="holo-ring"></div>

        <!-- Particle Assembly Effect -->
        <div class="particles-container">
          <div class="particle p1"></div>
          <div class="particle p2"></div>
          <div class="particle p3"></div>
          <div class="particle p4"></div>
          <div class="particle p5"></div>
          <div class="particle p6"></div>
          <div class="particle p7"></div>
          <div class="particle p8"></div>
        </div>

        <!-- Logo House with Pixelated Reveal -->
        <div class="entrance-logo-house"></div>

        <!-- Window Grid with Shutter Effect -->
        <div class="entrance-logo-window">
          <span class="window-pane"></span>
          <span class="window-pane"></span>
          <span class="window-pane"></span>
          <span class="window-pane"></span>
        </div>

        <!-- Checkmark with Bounce and Pulse -->
        <div class="entrance-logo-check">
          <div class="checkmark"></div>
          <div class="approval-pulse"></div>
        </div>
      </div>

      <!-- Typewriter Brand Text -->
      <div class="entrance-brand-text">
        <span class="brand-check">Check</span><span class="brand-my">My</span><span class="brand-rental">Rental</span>
      </div>
    </div>
  </div>

  <!-- Executive Gradient Mesh Background -->
  <div class="executive-bg"></div>

  <slot />

  <script is:inline>
    // Login Widget Functions - Load early to be available for Header
    const PORTAL_JWT_KEY = "portal_jwt";
    let loginFocusTrap = null;
    let escapeHandler = null;

    function toggleLoginWidget(e) {
      e.preventDefault();
      e.stopPropagation();
      const widget = document.getElementById('portal-login-widget');
      if (!widget) return;

      widget.classList.toggle('active');

      if (widget.classList.contains('active')) {
        if (window.FocusTrap && !loginFocusTrap) {
          loginFocusTrap = new window.FocusTrap(widget);
          loginFocusTrap.activate();
        }
        if (window.addEscapeKeyHandler && !escapeHandler) {
          escapeHandler = window.addEscapeKeyHandler(widget, closeLoginWidget);
        }
        setTimeout(() => {
          const emailField = widget.querySelector('input[type="email"]');
          if (emailField) emailField.focus();
        }, 100);
        setTimeout(() => {
          document.addEventListener('click', handleClickOutside);
        }, 100);
      } else {
        if (loginFocusTrap) {
          loginFocusTrap.deactivate();
          loginFocusTrap = null;
        }
        if (escapeHandler) {
          escapeHandler();
          escapeHandler = null;
        }
        document.removeEventListener('click', handleClickOutside);
      }
    }

    function closeLoginWidget() {
      const widget = document.getElementById('portal-login-widget');
      if (!widget) return;

      widget.classList.remove('active');
      if (loginFocusTrap) {
        loginFocusTrap.deactivate();
        loginFocusTrap = null;
      }
      if (escapeHandler) {
        escapeHandler();
        escapeHandler = null;
      }
      document.removeEventListener('click', handleClickOutside);
      document.querySelectorAll('.widget-error, .widget-success').forEach(el => {
        el.textContent = '';
        el.classList.remove('active');
      });
    }

    function handleClickOutside(e) {
      const widget = document.getElementById('portal-login-widget');
      const portalButton = e.target.closest('.cta-button');
      if (!widget.contains(e.target) && !portalButton) {
        closeLoginWidget();
      }
    }

    // Widget form functions
    // Call backend directly - CORS is already configured
    const API_BASE = "http://localhost:8000/api/portal";
    const DASHBOARD_URL = "http://localhost:3000"; // Next.js dashboard URL

    function switchTab(tab, evt) {
      document.querySelectorAll('.widget-tab').forEach(t => t.classList.remove('active'));
      if (evt && evt.target) {
        evt.target.classList.add('active');
      }
      document.querySelectorAll('.widget-form-container').forEach(f => f.classList.remove('active'));
      if (tab === 'login') {
        document.getElementById('widget-login-form').classList.add('active');
      } else {
        document.getElementById('widget-register-form').classList.add('active');
      }
      document.querySelectorAll('.widget-message').forEach(el => {
        el.textContent = '';
        el.classList.remove('active');
      });
    }

    // Social Login Handler
    function handleSocialLogin(provider) {
      // Build OAuth URL
      const redirectUri = encodeURIComponent(window.location.origin + '/auth/callback');
      const state = btoa(JSON.stringify({ provider, timestamp: Date.now() }));

      // Store state for verification
      sessionStorage.setItem('oauth_state', state);

      // Redirect to OAuth provider via backend
      window.location.href = `${API_BASE}/oauth/${provider}?redirect_uri=${redirectUri}&state=${state}`;
    }

    function generateOwnerId(fullName) {
      const ownerIdField = document.querySelector('input[name="owner_id"]');
      if (!ownerIdField || ownerIdField.dataset.manual === 'true') return;
      const ownerId = fullName.toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '_')
        .replace(/-+/g, '-')
        .substring(0, 30);
      ownerIdField.value = ownerId;
    }

    function setJWT(t){ localStorage.setItem("portal_jwt", t); }
    function getJWT(){ return localStorage.getItem("portal_jwt"); }

    async function fetchUserTokens() {
      try {
        const r = await fetch(`${API_BASE}/my-tokens`, {
          headers: { "Authorization":"Bearer "+getJWT() }
        });
        const data = await r.json();
        if (!r.ok) return [];
        return data.tokens || [];
      } catch {
        return [];
      }
    }

    async function handleWidgetLogin(e) {
      e.preventDefault();
      const form = e.target;
      const errorEl = document.getElementById('widget-login-error');
      const successEl = document.getElementById('widget-login-success');

      errorEl.textContent = '';
      errorEl.classList.remove('active');
      successEl.textContent = '';
      successEl.classList.remove('active');

      try {
        const response = await fetch(`${API_BASE}/login`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            email: form.email.value.trim(),
            password: form.password.value
          })
        });

        let data;
        try {
          data = await response.json();
        } catch (e) {
          throw new Error('Server error - please check if the backend is running');
        }
        if (!response.ok) throw new Error(data.detail || "Login failed");

        setJWT(data.access_token);
        successEl.textContent = 'Login successful! Redirecting...';
        successEl.classList.add('active');

        // Redirect to dashboard with JWT token
        const redirectUrl = `${DASHBOARD_URL}?token=${encodeURIComponent(data.access_token)}`;
        console.log('âœ… Login successful!');
        console.log('ðŸ“ Dashboard URL:', DASHBOARD_URL);
        console.log('ðŸŽ« Token:', data.access_token.substring(0, 50) + '...');
        console.log('ðŸ”— Redirecting to:', redirectUrl);

        setTimeout(() => {
          console.log('ðŸš€ Executing redirect now...');
          window.location.href = redirectUrl;
        }, 1000);
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.add('active');
      }
      return false;
    }

    async function handleWidgetRegister(e) {
      e.preventDefault();
      const form = e.target;
      const errorEl = document.getElementById('widget-register-error');
      const successEl = document.getElementById('widget-register-success');

      errorEl.textContent = '';
      errorEl.classList.remove('active');
      successEl.textContent = '';
      successEl.classList.remove('active');

      if (form.password.value !== form.confirm_password.value) {
        errorEl.textContent = 'Passwords do not match';
        errorEl.classList.add('active');
        return false;
      }

      const ownerId = form.owner_id.value.trim();
      if (!/^[a-zA-Z0-9_-]+$/.test(ownerId)) {
        errorEl.textContent = 'Owner ID can only contain letters, numbers, underscores, and hyphens';
        errorEl.classList.add('active');
        return false;
      }

      try {
        const response = await fetch(`${API_BASE}/register-owner`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            email: form.email.value.trim(),
            password: form.password.value,
            full_name: form.full_name.value.trim(),
            owner_id: ownerId
          })
        });

        let data;
        try {
          data = await response.json();
        } catch (e) {
          throw new Error('Server error - please check if the backend is running');
        }
        if (!response.ok) throw new Error(data.detail || "Registration failed");

        successEl.innerHTML = `
          <strong>Success!</strong> Your owner dashboard has been created.<br>
          Your dashboard URL: <strong>/owner/${ownerId}</strong><br>
          Redirecting to login...
        `;
        successEl.classList.add('active');

        setTimeout(() => {
          switchTab('login');
          form.reset();
          const loginForm = document.querySelector('#widget-login-form form');
          if (loginForm && loginForm.email) {
            loginForm.email.value = form.email.value.trim();
          }
        }, 3000);
      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.add('active');
      }
      return false;
    }

    // Magic Link Request Handler
    async function handleMagicLinkRequest(e) {
      e.preventDefault();
      const form = e.target;
      const button = form.querySelector('button[type="submit"]');
      const errorEl = document.getElementById('widget-email-error');
      const successEl = document.getElementById('widget-email-success');

      // Clear previous messages
      errorEl.textContent = '';
      errorEl.classList.remove('active');
      successEl.textContent = '';
      successEl.classList.remove('active');

      // Add loading state
      button.classList.add('loading');
      button.disabled = true;

      try {
        const response = await fetch(`${API_BASE}/request-magic-link`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            email: form.email.value.trim()
          })
        });

        let data;
        try {
          data = await response.json();
        } catch (e) {
          throw new Error('Server error - please check if the backend is running');
        }

        if (!response.ok) throw new Error(data.detail || "Failed to send magic link");

        // Success!
        if (data.magic_link) {
          // Development mode - show the magic link directly
          successEl.innerHTML = `
            <strong>Development Mode:</strong><br>
            <a href="${data.magic_link}" target="_blank" style="color: #e74c3c; font-weight: 600; text-decoration: underline;">
              Click here to login
            </a><br>
            <small style="color: #666; font-size: 0.75rem; display: block; margin-top: 0.5rem;">
              In production, this link would be sent to your email.
            </small>
          `;
        } else {
          // Production mode - email was sent
          successEl.innerHTML = `
            <strong>Check your email!</strong><br>
            We've sent a secure login link to <strong>${form.email.value.trim()}</strong>.<br>
            Click the link in the email to access your dashboard.
          `;
        }
        successEl.classList.add('active');
        form.reset();

      } catch (err) {
        errorEl.textContent = err.message;
        errorEl.classList.add('active');
      } finally {
        // Remove loading state
        button.classList.remove('loading');
        button.disabled = false;
      }

      return false;
    }

    // Make all functions globally available immediately
    window.toggleLoginWidget = toggleLoginWidget;
    window.closeLoginWidget = closeLoginWidget;
    window.switchTab = switchTab;
    window.generateOwnerId = generateOwnerId;
    window.handleWidgetLogin = handleWidgetLogin;
    window.handleWidgetRegister = handleWidgetRegister;
    window.handleSocialLogin = handleSocialLogin;
  </script>

  <script>
    // Initialize theme (default is dark mode, light mode is opt-in)
    function initTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-mode');
      }
    }

    // Function to handle page reveal
    function handlePageReveal() {
      // Apply theme on every page load
      initTheme();

      const entranceCurtain = document.getElementById('entrance-curtain');
      const isLandingPage = window.location.pathname === '/landing' || window.location.pathname === '/';

      // Check for reduced motion preference
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Reset entrance curtain classes
      if (entranceCurtain) {
        entranceCurtain.classList.remove('show-entrance', 'hide-entrance');

        if (isLandingPage && !prefersReducedMotion) {
          entranceCurtain.classList.add('show-entrance');
        } else {
          entranceCurtain.classList.add('hide-entrance');
        }
      }

      // Set delay: full animation for landing (3.5s redesigned animation), instant for others or reduced motion
      const delay = (isLandingPage && !prefersReducedMotion) ? 3500 : 0;

      setTimeout(() => {
        const header = document.querySelector('.header');
        const main = document.querySelector('main');
        if (header) header.classList.add('revealed');
        if (main) main.classList.add('revealed');
      }, delay);

      // Remove entrance curtain after animation completes
      if (isLandingPage && entranceCurtain) {
        setTimeout(() => {
          entranceCurtain.classList.add('fade-complete');
        }, 4200);
      }
    }

    // Initial page load
    document.addEventListener('DOMContentLoaded', function() {
      handlePageReveal();
    });

    // Handle Astro view transitions (client-side navigation)
    document.addEventListener('astro:page-load', function() {
      handlePageReveal();
    });

    // Listen for theme changes from other tabs
    window.addEventListener('storage', (e) => {
      if (e.key === 'theme') {
        if (e.newValue === 'light') {
          document.body.classList.add('light-mode');
        } else {
          document.body.classList.remove('light-mode');
        }
      }
    });
  </script>
</body>
</html>

<style is:global>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
    scroll-padding-top: 80px;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: #0a0a0f;
    color: #f0f0f0;
    line-height: 1.6;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    opacity: 0;
    animation: bodyFadeIn 0.6s ease-out forwards;
  }

  @keyframes bodyFadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
  }

  /* Entrance Animation */
  .entrance-curtain {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a0f 100%);
    z-index: 900;
    pointer-events: none !important;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    overflow: hidden;
  }

  /* Show entrance animation for landing page */
  .entrance-curtain.show-entrance {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
    animation: curtainFade 0.8s cubic-bezier(0.4, 0, 0.2, 1) 3.2s forwards;
  }

  .entrance-curtain.fade-complete {
    display: none !important;
  }

  /* Hide entrance immediately for other pages */
  .entrance-curtain.hide-entrance {
    opacity: 0;
    visibility: hidden;
    display: none;
  }

  @keyframes curtainFade {
    0% {
      opacity: 1;
      transform: scale(1);
      filter: brightness(1);
    }
    50% {
      filter: brightness(1.1);
    }
    100% {
      opacity: 0;
      visibility: hidden;
      transform: scale(1.05);
      filter: brightness(1.2);
    }
  }

  /* Static background - no animation */
  .entrance-curtain::before {
    display: none;
  }

  .entrance-logo-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    z-index: 1;
  }

  .entrance-logo {
    position: relative;
    width: 140px;
    height: 140px;
  }

  /* ===== PHASE 1: SCAN ENTRANCE (0s - 1.2s) ===== */

  /* Scanning Grid Overlay */
  .scan-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(0deg, transparent 24%, rgba(100, 200, 255, 0.05) 25%, rgba(100, 200, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(100, 200, 255, 0.05) 75%, rgba(100, 200, 255, 0.05) 76%, transparent 77%, transparent),
      linear-gradient(90deg, transparent 24%, rgba(100, 200, 255, 0.05) 25%, rgba(100, 200, 255, 0.05) 26%, transparent 27%, transparent 74%, rgba(100, 200, 255, 0.05) 75%, rgba(100, 200, 255, 0.05) 76%, transparent 77%, transparent);
    background-size: 50px 50px;
    opacity: 0;
    animation: gridFadeIn 0.6s ease-out 0.2s forwards, gridFadeOut 0.5s ease-in 1.0s forwards;
    pointer-events: none;
  }

  @keyframes gridFadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
  }

  @keyframes gridFadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
  }

  /* Horizontal Scan Line */
  .scan-line {
    position: absolute;
    top: 50%;
    left: -100%;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, transparent 0%, rgba(100, 200, 255, 0.8) 50%, transparent 100%);
    box-shadow: 0 0 20px rgba(100, 200, 255, 0.6), 0 0 40px rgba(100, 200, 255, 0.4);
    animation: scanSweep 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0s forwards;
    z-index: 10;
  }

  @keyframes scanSweep {
    0% { left: -100%; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { left: 100%; opacity: 0; }
  }

  /* Scanning Dot */
  .scan-dot {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translate(50%, -50%);
    width: 12px;
    height: 12px;
    background: #e74c3c;
    border-radius: 50%;
    box-shadow: 0 0 15px rgba(231, 76, 60, 0.8), 0 0 30px rgba(231, 76, 60, 0.5);
    animation: dotPulse 0.3s ease-in-out infinite;
  }

  @keyframes dotPulse {
    0%, 100% { transform: translate(50%, -50%) scale(1); }
    50% { transform: translate(50%, -50%) scale(1.3); }
  }

  /* Energy Waves */
  .energy-wave {
    position: absolute;
    width: 600px;
    height: 600px;
    left: 50%;
    top: 50%;
    margin-left: -300px;
    margin-top: -300px;
    pointer-events: none;
  }

  .energy-wave::before,
  .energy-wave::after {
    content: '';
    position: absolute;
    inset: 0;
    border: 2px solid rgba(100, 200, 255, 0.4);
    border-radius: 50%;
    opacity: 0;
    transform: scale(0.2);
    box-shadow: 0 0 20px rgba(100, 200, 255, 0.3);
  }

  .energy-wave::before {
    animation: waveRing 1.8s ease-out forwards;
  }

  .energy-wave::after {
    animation: waveRing 1.8s ease-out 0.2s forwards;
    border-color: rgba(100, 200, 255, 0.25);
    box-shadow: 0 0 15px rgba(100, 200, 255, 0.2);
  }

  .wave-1::before {
    animation-delay: 0.4s;
  }

  .wave-1::after {
    animation-delay: 0.6s;
  }

  .wave-2::before {
    animation-delay: 0.7s;
  }

  .wave-2::after {
    animation-delay: 0.9s;
  }

  .wave-3::before {
    animation-delay: 1.0s;
  }

  .wave-3::after {
    animation-delay: 1.2s;
  }

  @keyframes waveRing {
    0% {
      opacity: 0;
      transform: scale(0.2);
    }
    15% {
      opacity: 0.6;
    }
    100% {
      opacity: 0;
      transform: scale(1.2);
    }
  }

  /* ===== PHASE 2: CONSTRUCTION & ASSEMBLY (1.2s - 2.4s) ===== */

  /* Holographic Ring */
  .holo-ring {
    position: absolute;
    width: 200px;
    height: 200px;
    border: 2px solid transparent;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    margin-top: -100px;
    margin-left: -100px;
    background:
      linear-gradient(#0a0a0f, #0a0a0f) padding-box,
      linear-gradient(135deg, rgba(100, 200, 255, 0.6), rgba(231, 76, 60, 0.4)) border-box;
    opacity: 0;
    transform: scale(0);
    animation: holoExpand 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 1.2s forwards,
               holoPulse 2s ease-in-out 2.0s infinite;
  }

  @keyframes holoExpand {
    0% {
      opacity: 0;
      transform: scale(0);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes holoPulse {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.6;
      transform: scale(1.05);
    }
  }

  /* Particle Assembly */
  .particles-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #64c8ff;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(100, 200, 255, 0.8);
    opacity: 0;
  }

  .p1 { animation: particleAssemble 0.8s ease-out 1.2s forwards; top: 0; left: 0; }
  .p2 { animation: particleAssemble 0.8s ease-out 1.3s forwards; top: 0; right: 0; }
  .p3 { animation: particleAssemble 0.8s ease-out 1.4s forwards; bottom: 0; left: 0; }
  .p4 { animation: particleAssemble 0.8s ease-out 1.5s forwards; bottom: 0; right: 0; }
  .p5 { animation: particleAssemble 0.8s ease-out 1.35s forwards; top: 50%; left: 0; }
  .p6 { animation: particleAssemble 0.8s ease-out 1.45s forwards; top: 50%; right: 0; }
  .p7 { animation: particleAssemble 0.8s ease-out 1.55s forwards; top: 0; left: 50%; }
  .p8 { animation: particleAssemble 0.8s ease-out 1.65s forwards; bottom: 0; left: 50%; }

  @keyframes particleAssemble {
    0% {
      opacity: 1;
      transform: translate(0, 0);
    }
    100% {
      opacity: 0;
      transform: translate(calc(-50% + 70px), calc(-50% + 70px));
    }
  }

  .entrance-logo-house {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0) rotate(45deg);
    animation: housePixelate 0.6s steps(8) 1.3s forwards, houseStabilize 0.3s ease-out 1.9s forwards;
    box-shadow: 0 15px 45px rgba(0, 0, 0, 0.4);
    border-radius: 2px;
    opacity: 0;
  }

  @keyframes housePixelate {
    0% {
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      opacity: 0;
      filter: blur(8px) contrast(2);
    }
    100% {
      transform: translate(-50%, -50%) scale(1.1) rotate(50deg);
      opacity: 1;
      filter: blur(0px) contrast(1);
    }
  }

  @keyframes houseStabilize {
    0% {
      transform: translate(-50%, -50%) scale(1.1) rotate(50deg);
    }
    100% {
      transform: translate(-50%, -50%) scale(1) rotate(45deg);
    }
  }

  /* Window Panes with Shutter Effect */
  .entrance-logo-window {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 6px;
    width: 40px;
    height: 40px;
  }

  .window-pane {
    background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
    display: block;
    border-radius: 1px;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
    transform: scaleY(0);
    transform-origin: top;
    opacity: 0;
  }

  .window-pane:nth-child(1) {
    animation: shutterSnap 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 1.9s forwards;
  }
  .window-pane:nth-child(2) {
    animation: shutterSnap 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.0s forwards;
  }
  .window-pane:nth-child(3) {
    animation: shutterSnap 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.1s forwards;
  }
  .window-pane:nth-child(4) {
    animation: shutterSnap 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.2s forwards;
  }

  @keyframes shutterSnap {
    0% {
      transform: scaleY(0);
      opacity: 0;
    }
    60% {
      transform: scaleY(1.1);
    }
    100% {
      transform: scaleY(1);
      opacity: 1;
    }
  }

  /* ===== PHASE 3: APPROVAL & BRAND REVEAL (2.4s - 3.5s) ===== */

  /* Checkmark with Bounce */
  .entrance-logo-check {
    position: absolute;
    bottom: -8px;
    right: -8px;
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    border-radius: 50%;
    transform: scale(0) translateX(200px);
    animation: checkShootIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.4s forwards;
    box-shadow: 0 8px 24px rgba(231, 76, 60, 0.6),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
    opacity: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @keyframes checkShootIn {
    0% {
      transform: scale(0) translateX(200px) rotate(-360deg);
      opacity: 0;
    }
    70% {
      transform: scale(1.3) translateX(0) rotate(15deg);
      opacity: 1;
    }
    85% {
      transform: scale(0.9) translateX(0) rotate(-5deg);
    }
    100% {
      transform: scale(1) translateX(0) rotate(0deg);
      opacity: 1;
    }
  }

  /* Approval Pulse Ring */
  .approval-pulse {
    position: absolute;
    inset: -10px;
    border: 3px solid rgba(46, 204, 113, 0.8);
    border-radius: 50%;
    opacity: 0;
    transform: scale(0.8);
    animation: pulseFade 0.8s ease-out 2.6s forwards;
  }

  @keyframes pulseFade {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 1;
      transform: scale(1.5);
    }
    100% {
      opacity: 0;
      transform: scale(2);
    }
  }

  .checkmark {
    position: absolute;
    width: 32px;
    height: 32px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    z-index: 100;
    animation: checkmarkReveal 0.4s ease-out 2.5s forwards;
  }

  .checkmark::after {
    content: 'âœ“';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(0);
    color: white;
    font-size: 24px;
    font-weight: 900;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    animation: checkmarkPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) 2.55s forwards;
  }

  @keyframes checkmarkReveal {
    0% { opacity: 0; }
    100% { opacity: 1; }
  }

  @keyframes checkmarkPop {
    0% {
      transform: translate(-50%, -50%) scale(0) rotate(-90deg);
    }
    70% {
      transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
    }
    100% {
      transform: translate(-50%, -50%) scale(1) rotate(0deg);
    }
  }

  /* Typewriter Brand Text */
  .entrance-brand-text {
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    opacity: 0;
    animation: textFadeIn 0.3s ease-out 2.7s forwards;
  }

  @keyframes textFadeIn {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .brand-check,
  .brand-my,
  .brand-rental {
    display: inline-block;
    opacity: 0;
    transform: translateX(-10px);
  }

  .brand-check {
    color: #ffffff;
    margin-right: -0.1em;
    animation: letterType 0.2s ease-out 2.8s forwards;
  }

  .brand-my {
    color: rgba(255, 255, 255, 0.6);
    margin-right: -0.1em;
    animation: letterType 0.2s ease-out 2.95s forwards;
  }

  .brand-rental {
    color: #e74c3c;
    text-shadow: 0 2px 12px rgba(231, 76, 60, 0.4);
    animation: letterType 0.2s ease-out 3.1s forwards;
  }

  @keyframes letterType {
    0% {
      opacity: 0;
      transform: translateX(-10px);
    }
    60% {
      transform: translateX(2px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* ===== Reduced Motion Support ===== */
  @media (prefers-reduced-motion: reduce) {
    .scan-grid,
    .scan-line,
    .scan-dot,
    .energy-wave,
    .holo-ring,
    .particle,
    .approval-pulse,
    .entrance-curtain::before {
      animation: none !important;
    }

    .entrance-logo-house,
    .window-pane,
    .entrance-logo-check,
    .checkmark,
    .brand-check,
    .brand-my,
    .brand-rental {
      animation: simpleReveal 0.3s ease-out forwards !important;
    }

    @keyframes simpleReveal {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
  }

  /* Executive Background */
  .executive-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(ellipse at 20% 20%, rgba(100, 116, 139, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(71, 85, 105, 0.03) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
  }

  /* Header reveal */
  .header,
  main {
    opacity: 0;
    animation: contentFallback 0.1s linear 4.0s forwards;
  }

  .header.revealed,
  main.revealed {
    opacity: 1;
    animation: contentReveal 0.8s ease-out forwards;
  }

  @keyframes contentReveal {
    0% { opacity: 0; transform: scale(0.98); }
    100% { opacity: 1; transform: scale(1); }
  }

  @keyframes contentFallback {
    100% { opacity: 1; }
  }

  /* Light mode styles */
  body.light-mode {
    background: #f8f9fc;
    color: #1a1a1a;
  }

  body.light-mode .executive-bg {
    background: radial-gradient(ellipse at 20% 20%, rgba(231, 76, 60, 0.02) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(231, 76, 60, 0.015) 0%, transparent 50%);
  }

  /* ===== Scroll-Triggered Animations ===== */
  .scroll-reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scroll-reveal.revealed {
    opacity: 1;
    transform: translateY(0);
  }

  .scroll-reveal-scale {
    opacity: 0;
    transform: scale(0.95);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scroll-reveal-scale.revealed {
    opacity: 1;
    transform: scale(1);
  }

  .scroll-reveal-left {
    opacity: 0;
    transform: translateX(-50px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scroll-reveal-left.revealed {
    opacity: 1;
    transform: translateX(0);
  }

  .scroll-reveal-right {
    opacity: 0;
    transform: translateX(50px);
    transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scroll-reveal-right.revealed {
    opacity: 1;
    transform: translateX(0);
  }

  /* Staggered animations for child elements */
  .scroll-reveal-stagger > * {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .scroll-reveal-stagger.revealed > *:nth-child(1) { transition-delay: 0.05s; }
  .scroll-reveal-stagger.revealed > *:nth-child(2) { transition-delay: 0.1s; }
  .scroll-reveal-stagger.revealed > *:nth-child(3) { transition-delay: 0.15s; }
  .scroll-reveal-stagger.revealed > *:nth-child(4) { transition-delay: 0.2s; }
  .scroll-reveal-stagger.revealed > *:nth-child(5) { transition-delay: 0.25s; }
  .scroll-reveal-stagger.revealed > *:nth-child(6) { transition-delay: 0.3s; }
  .scroll-reveal-stagger.revealed > *:nth-child(7) { transition-delay: 0.35s; }
  .scroll-reveal-stagger.revealed > *:nth-child(8) { transition-delay: 0.4s; }

  .scroll-reveal-stagger.revealed > * {
    opacity: 1;
    transform: translateY(0);
  }

  /* Parallax scroll effect */
  .scroll-parallax {
    will-change: transform;
    transition: transform 0.1s ease-out;
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }

    .scroll-reveal,
    .scroll-reveal-scale,
    .scroll-reveal-left,
    .scroll-reveal-right,
    .scroll-reveal-stagger > *,
    .scroll-parallax {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>
