---
import LandingLayout from '../layouts/LandingLayout.astro';
import Header from '../components/Header.astro';
import LandingFooter from '../components/LandingFooter.astro';

// Formspree endpoint - UPDATE WITH YOUR FORM ID
const FORMSPREE_ENDPOINT = "https://formspree.io/f/xdaekzkl";
---

<LandingLayout
  title="Book Your Inspection | CheckMyRental"
  description="Book your professional property inspection - enter property details and we'll send you an invoice"
>
  <Header />

  <main id="main-content" class="checkout-main" tabindex="-1">
    <div class="checkout-container">
      <!-- Form View -->
      <div id="form-view">
        <div class="checkout-header">
          <h1>Start Property Inspections</h1>
          <p>Register your properties and choose your preferred inspection schedule</p>
          <div class="service-highlight">
            <span class="highlight-icon">üîÑ</span>
            <span>Flexible scheduling ‚Ä¢ No contracts ‚Ä¢ Same-day reports</span>
          </div>
        </div>

        <div class="checkout-content">
          <!-- Left: Form -->
          <div class="checkout-form-section">
            <!-- Mobile Wizard Progress (hidden on desktop) -->
            <div class="wizard-progress" aria-label="Form progress">
              <div class="wizard-progress-bar">
                <div class="wizard-progress-fill" id="wizard-progress-fill"></div>
              </div>
              <p class="wizard-step-indicator">
                Step <span id="wizard-current-step">1</span> of 3
              </p>
            </div>

            <form id="checkout-form" action={FORMSPREE_ENDPOINT} method="POST">
              <!-- Hidden fields for Formspree -->
              <input type="hidden" name="_subject" value="New Inspection Request" />
              <input type="hidden" name="calculated_total" id="hidden-total" value="$0.00" />

              <!-- Step 1: Contact Information -->
              <div class="form-section" data-wizard-step="1">
                <h2><span class="step-number">1</span> Contact Information</h2>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="full-name">Full Name <span class="required">*</span></label>
                    <input type="text" id="full-name" name="full_name" required />
                  </div>

                  <div class="form-group">
                    <label for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required />
                  </div>

                  <div class="form-group">
                    <label for="phone">Phone Number <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" required />
                  </div>
                </div>
              </div>

              <!-- Step 2: Properties -->
              <div class="form-section" data-wizard-step="2">
                <h2><span class="step-number">2</span> Properties to Inspect</h2>
                <p class="section-desc">Add all properties you'd like inspected. You'll receive an invoice based on your chosen frequency.</p>

                <div id="properties-container">
                  <!-- Property 1 (default) -->
                  <div class="property-card" data-property-index="1">
                    <div class="property-card-header">
                      <span class="property-number">Property 1</span>
                      <button type="button" class="remove-property-btn" style="display: none;" aria-label="Remove property">√ó</button>
                    </div>

                    <!-- Property Type Pills -->
                    <div class="property-type-pills">
                      <label class="type-pill">
                        <input type="radio" name="property_1_type" value="apartment" required />
                        <span class="pill-content">
                          <span class="pill-icon">üè¢</span>
                          <span class="pill-label">Apartment</span>
                          <span class="pill-price">$70</span>
                        </span>
                      </label>
                      <label class="type-pill">
                        <input type="radio" name="property_1_type" value="single_family" checked />
                        <span class="pill-content">
                          <span class="pill-icon">üè†</span>
                          <span class="pill-label">House</span>
                          <span class="pill-price">$100</span>
                        </span>
                      </label>
                      <label class="type-pill">
                        <input type="radio" name="property_1_type" value="multifamily" />
                        <span class="pill-content">
                          <span class="pill-icon">üèòÔ∏è</span>
                          <span class="pill-label">Multi</span>
                          <span class="pill-price">$165</span>
                        </span>
                      </label>
                    </div>

                    <!-- Address -->
                    <input type="text" class="property-address" name="property_1_address" placeholder="Property address (e.g. 123 Main St, Tampa, FL)" required />

                    <!-- Tenant Info Row -->
                    <div class="tenant-row">
                      <input type="text" name="property_1_tenant_name" placeholder="Tenant name" />
                      <input type="tel" name="property_1_tenant_phone" placeholder="Tenant phone (for booking text)" />
                    </div>
                  </div>
                </div>

                <button type="button" id="add-property-btn" class="add-property-link">
                  + Add property
                </button>
              </div>

              <!-- Step 3: Preferences -->
              <div class="form-section" data-wizard-step="3">
                <h2><span class="step-number">3</span> Choose Your Schedule</h2>
                <div class="form-row-2">
                  <div class="form-group">
                    <label for="preferred-timeframe">Preferred Timeframe <span class="required">*</span></label>
                    <select id="preferred-timeframe" name="preferred_timeframe" required>
                      <option value="">Select a timeframe...</option>
                      <option value="asap">As soon as possible</option>
                      <option value="this_week">This week</option>
                      <option value="next_week">Next week</option>
                      <option value="this_month">Within this month</option>
                      <option value="flexible">I'm flexible</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="inspection-frequency">Inspection Frequency <span class="required">*</span></label>
                    <select id="inspection-frequency" name="inspection_frequency" required>
                      <option value="quarterly" selected>Quarterly (Recommended ‚Äî Industry Standard)</option>
                      <option value="monthly">Monthly</option>
                      <option value="bimonthly">Every 2 Months</option>
                      <option value="weekly">Weekly</option>
                      <option value="one_time">One Time</option>
                      <option value="custom">Custom Schedule</option>
                    </select>
                    <p class="field-hint">Industry data shows quarterly inspections are the optimal frequency for most rental properties ‚Äî catching issues early while keeping costs manageable.</p>
                  </div>

                  <div class="form-group">
                    <label for="payment-preference">Invoice Payment Method <span class="required">*</span></label>
                    <select id="payment-preference" name="payment_preference" required>
                      <option value="" disabled selected hidden>Select payment method...</option>
                      <option value="zelle">Zelle (save 3% on fees)</option>
                      <option value="card">Credit/Debit Card (+3% fee)</option>
                    </select>
                  </div>
                </div>

                <div class="form-group">
                  <label for="notes">Additional Notes</label>
                  <textarea id="notes" name="notes" rows="2" placeholder="Any special requests or scheduling constraints?"></textarea>
                </div>
              </div>

              <!-- Terms -->
              <div class="form-group checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="terms" name="terms" required />
                  <span>I agree to the <a href="/terms" target="_blank">Terms of Service</a> and <a href="/privacy" target="_blank">Privacy Policy</a></span>
                </label>
              </div>

              <!-- Mobile Wizard Navigation (hidden on desktop) -->
              <div class="wizard-nav">
                <button type="button" id="wizard-back-btn" class="wizard-btn wizard-btn-back" disabled>
                  Back
                </button>
                <button type="button" id="wizard-next-btn" class="wizard-btn wizard-btn-next">
                  Next
                </button>
              </div>
            </form>
          </div>

          <!-- Right: Order Summary & Submit -->
          <div class="order-summary-section">
            <!-- Mobile Order Summary Toggle (hidden on desktop) -->
            <div class="mobile-order-summary-toggle" id="mobile-summary-toggle">
              <button type="button" class="mobile-summary-btn" id="toggle-summary-btn" aria-expanded="false">
                <span class="mobile-summary-label">Order Summary</span>
                <span class="mobile-summary-total" id="mobile-summary-total">$100.00</span>
                <span class="mobile-summary-chevron">‚ñº</span>
              </button>
              <div class="mobile-summary-content" id="mobile-summary-content">
                <!-- Content cloned from desktop summary via JS -->
              </div>
            </div>

            <div class="order-summary-card">
              <h3>Order Summary</h3>

              <div id="summary-items">
                <div class="summary-line-item">
                  <span>1√ó Single Family Home</span>
                  <span>$100.00</span>
                </div>
              </div>

              <div class="summary-divider"></div>

              <div class="summary-row total">
                <span>Per-Visit Total</span>
                <span id="summary-total">$100.00</span>
              </div>

              <p class="summary-note">You'll receive invoices based on your selected frequency.</p>
            </div>

            <!-- Submit Button -->
            <button type="submit" form="checkout-form" class="submit-btn">
              <span class="submit-icon">üîÑ</span>
              <span class="submit-text">
                <span class="submit-label">Submit Inquiry</span>
                <span class="submit-sublabel">We'll send your first invoice within 24 hours</span>
              </span>
            </button>

            <div class="contact-help">
              <p>Questions? <a href="mailto:info@checkmyrental.io">info@checkmyrental.io</a></p>
              <p><a href="tel:8132520524">(813) 252-0524</a></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Success View (hidden by default) -->
      <div id="success-view" style="display: none;">
        <div class="success-container">
          <div class="success-icon">‚úì</div>
          <h1>You're All Set!</h1>
          <p class="success-message">Welcome to CheckMyRental! Your inspection schedule has been set up. We'll send your first invoice within 24 hours.</p>

          <div class="success-details">
            <h3>What happens next?</h3>
            <ol>
              <li><strong>First invoice</strong> ‚Äî You'll receive your first invoice via email within 24 hours</li>
              <li><strong>Payment</strong> ‚Äî Pay by card directly on the invoice, or via Zelle to save on fees</li>
              <li><strong>Tenant notification</strong> ‚Äî We'll text your tenant(s) a booking link (required 24-hour notice per FL law)</li>
              <li><strong>Tenant books time</strong> ‚Äî Your tenant selects an available appointment slot</li>
              <li><strong>Inspection</strong> ‚Äî We conduct the property documentation visit</li>
              <li><strong>Report delivery</strong> ‚Äî Receive your detailed report within 24 hours of the visit</li>
            </ol>
          </div>

          <div class="success-note">
            <p><strong>About tenant notification:</strong> Per Florida Statute 83.53, tenants must receive at least 24 hours notice before property inspections. We handle this by texting your tenant a booking link.</p>
          </div>

          <div class="success-note" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.2);">
            <p>Need to add or remove properties? Just reply to any invoice email or contact us directly.</p>
          </div>

          <a href="/" class="back-home-btn">Back to Home</a>
        </div>
      </div>
    </div>
  </main>

  <LandingFooter />
</LandingLayout>

<style>
  .checkout-main {
    padding-top: 100px;
    min-height: 100vh;
    background: linear-gradient(135deg, rgba(10, 10, 15, 0.98) 0%, rgba(20, 20, 30, 0.98) 100%);
  }

  body.light-mode .checkout-main {
    background: linear-gradient(135deg, #f8f9fc 0%, #ffffff 100%);
  }

  .checkout-container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 2rem 2rem 4rem;
  }

  .checkout-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .checkout-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.5rem;
  }

  body.light-mode .checkout-header h1 {
    color: #1a1a1a;
  }

  .checkout-header p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.1rem;
  }

  body.light-mode .checkout-header p {
    color: #666;
  }

  .service-highlight {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0.75rem 1.25rem;
    background: rgba(231, 76, 60, 0.1);
    border: 1px solid rgba(231, 76, 60, 0.2);
    border-radius: 50px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
  }

  body.light-mode .service-highlight {
    background: rgba(231, 76, 60, 0.08);
    color: #444;
  }

  .highlight-icon {
    font-size: 1.1rem;
  }

  .checkout-content {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 2rem;
    align-items: start;
  }

  /* Form Section */
  .checkout-form-section {
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 2rem;
  }

  body.light-mode .checkout-form-section {
    background: white;
    border-color: rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .form-section {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .form-section:last-of-type {
    border-bottom: none;
    margin-bottom: 1rem;
  }

  body.light-mode .form-section {
    border-bottom-color: rgba(0, 0, 0, 0.1);
  }

  .form-section h2 {
    font-size: 1.25rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  body.light-mode .form-section h2 {
    color: #1a1a1a;
  }

  .section-desc {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.95rem;
    margin-bottom: 1.5rem;
  }

  body.light-mode .section-desc {
    color: #666;
  }

  .field-hint {
    font-size: 0.78rem;
    color: rgba(255, 255, 255, 0.5);
    margin-top: 0.25rem;
    line-height: 1.4;
  }

  body.light-mode .field-hint {
    color: rgba(0, 0, 0, 0.5);
  }

  .step-number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    border-radius: 50%;
    font-size: 0.9rem;
    font-weight: 700;
  }

  .popular-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
    padding: 0.2rem 0.6rem;
    border-radius: 20px;
    margin-left: 0.5rem;
    vertical-align: middle;
    letter-spacing: 0.02em;
  }

  body.light-mode .popular-badge {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
  }

  /* Property Card */
  .property-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1rem;
  }

  body.light-mode .property-card {
    background: rgba(0, 0, 0, 0.02);
    border-color: rgba(0, 0, 0, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }

  .property-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .property-number {
    font-weight: 700;
    color: #e74c3c;
    font-size: 0.9rem;
  }

  .remove-property-btn {
    background: rgba(231, 76, 60, 0.1);
    border: none;
    color: #e74c3c;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
    transition: all 0.2s;
  }

  .remove-property-btn:hover {
    background: #e74c3c;
    color: white;
  }

  /* Property Type Pills - Horizontal Selection */
  .property-type-pills {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .type-pill {
    flex: 1;
    cursor: pointer;
  }

  .type-pill input {
    display: none;
  }

  .pill-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    padding: 0.65rem 0.5rem;
    background: rgba(255, 255, 255, 0.04);
    border: 2px solid rgba(255, 255, 255, 0.12);
    border-radius: 25px;
    transition: all 0.2s;
  }

  .type-pill input:checked + .pill-content {
    background: rgba(231, 76, 60, 0.15);
    border-color: #e74c3c;
  }

  .pill-content:hover {
    border-color: rgba(231, 76, 60, 0.5);
  }

  body.light-mode .pill-content {
    background: rgba(0, 0, 0, 0.03);
    border-color: rgba(0, 0, 0, 0.12);
  }

  body.light-mode .type-pill input:checked + .pill-content {
    background: rgba(231, 76, 60, 0.1);
    border-color: #e74c3c;
  }

  .pill-icon {
    font-size: 1.1rem;
  }

  .pill-label {
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.85rem;
  }

  body.light-mode .pill-label {
    color: #333;
  }

  .pill-price {
    font-weight: 700;
    color: #e74c3c;
    font-size: 0.85rem;
  }

  /* Property Address Input */
  .property-address {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    color: white;
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
    transition: all 0.2s;
  }

  .property-address:focus {
    outline: none;
    border-color: #e74c3c;
    background: rgba(255, 255, 255, 0.08);
  }

  body.light-mode .property-address {
    background: rgba(0, 0, 0, 0.03);
    border-color: rgba(0, 0, 0, 0.15);
    color: #1a1a1a;
  }

  body.light-mode .property-address:focus {
    background: white;
    border-color: #e74c3c;
  }

  /* Tenant Row - Compact 2-column */
  .tenant-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .tenant-row input {
    padding: 0.6rem 0.75rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.85rem;
    transition: all 0.2s;
  }

  .tenant-row input::placeholder {
    color: rgba(255, 255, 255, 0.4);
  }

  .tenant-row input:focus {
    outline: none;
    border-color: rgba(231, 76, 60, 0.5);
    background: rgba(255, 255, 255, 0.05);
  }

  body.light-mode .tenant-row input {
    background: rgba(0, 0, 0, 0.02);
    border-color: rgba(0, 0, 0, 0.1);
    color: #333;
  }

  body.light-mode .tenant-row input::placeholder {
    color: rgba(0, 0, 0, 0.4);
  }

  body.light-mode .tenant-row input:focus {
    background: white;
    border-color: rgba(231, 76, 60, 0.5);
  }

  /* Add Property Link */
  .add-property-link {
    display: inline-flex;
    align-items: center;
    background: none;
    border: none;
    color: #e74c3c;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.5rem 0;
    margin-top: 0.25rem;
    transition: all 0.2s;
  }

  .add-property-link:hover {
    color: #c0392b;
    text-decoration: underline;
  }

  /* Form Fields */
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .form-row-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .form-group:last-child {
    margin-bottom: 0;
  }

  .form-group label {
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
  }

  body.light-mode .form-group label {
    color: #333;
  }

  .required {
    color: #e74c3c;
  }

  .form-group input,
  .form-group textarea,
  .form-group select {
    padding: 0.875rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    color: white;
    font-size: 1rem;
    transition: all 0.3s;
    font-family: inherit;
  }

  body.light-mode .form-group input,
  body.light-mode .form-group textarea,
  body.light-mode .form-group select {
    background: rgba(0, 0, 0, 0.03);
    border-color: rgba(0, 0, 0, 0.15);
    color: #1a1a1a;
  }

  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    outline: none;
    border-color: #e74c3c;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
  }

  body.light-mode .form-group input:focus,
  body.light-mode .form-group textarea:focus,
  body.light-mode .form-group select:focus {
    background: white;
    border-color: #e74c3c;
  }

  .checkbox-group {
    margin-top: 1rem;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.8);
  }

  body.light-mode .checkbox-label {
    color: rgba(0, 0, 0, 0.7);
  }

  .checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .checkbox-label a {
    color: #e74c3c;
    text-decoration: underline;
  }

  /* Order Summary Section */
  .order-summary-section {
    position: sticky;
    top: 100px;
  }

  .order-summary-card {
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  body.light-mode .order-summary-card {
    background: white;
    border-color: rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .order-summary-card h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1.5rem;
  }

  body.light-mode .order-summary-card h3 {
    color: #1a1a1a;
  }

  #summary-items {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .summary-line-item {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    background: rgba(231, 76, 60, 0.1);
    border-radius: 8px;
    color: white;
    font-size: 0.95rem;
  }

  body.light-mode .summary-line-item {
    color: #1a1a1a;
  }

  .summary-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 1rem 0;
  }

  body.light-mode .summary-divider {
    background: rgba(0, 0, 0, 0.1);
  }

  .summary-row.total {
    display: flex;
    justify-content: space-between;
    font-size: 1.25rem;
    font-weight: 700;
    color: white;
  }

  body.light-mode .summary-row.total {
    color: #1a1a1a;
  }

  #summary-total {
    color: #e74c3c;
  }

  .summary-note {
    margin-top: 1rem;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
    line-height: 1.5;
  }

  body.light-mode .summary-note {
    color: #666;
  }

  /* Submit Button */
  .submit-btn {
    width: 100%;
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
    margin-bottom: 1rem;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
  }

  .submit-icon {
    font-size: 1.5rem;
  }

  .submit-text {
    flex: 1;
    text-align: left;
  }

  .submit-label {
    display: block;
    font-weight: 700;
    color: white;
    font-size: 1.1rem;
  }

  .submit-sublabel {
    display: block;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
  }

  .contact-help {
    text-align: center;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
    margin-top: 1.5rem;
  }

  body.light-mode .contact-help {
    color: #666;
  }

  .contact-help a {
    color: #e74c3c;
    text-decoration: none;
  }

  .contact-help a:hover {
    text-decoration: underline;
  }

  /* Success View */
  .success-container {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
    padding: 3rem 2rem;
  }

  .success-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    color: white;
    margin: 0 auto 2rem;
  }

  .success-container h1 {
    font-size: 2rem;
    color: white;
    margin-bottom: 1rem;
  }

  body.light-mode .success-container h1 {
    color: #1a1a1a;
  }

  .success-message {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    margin-bottom: 2rem;
  }

  body.light-mode .success-message {
    color: #666;
  }

  .success-details {
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 2rem;
    text-align: left;
    margin-bottom: 2rem;
  }

  body.light-mode .success-details {
    background: white;
    border-color: rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .success-details h3 {
    color: white;
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }

  body.light-mode .success-details h3 {
    color: #1a1a1a;
  }

  .success-details ol {
    color: rgba(255, 255, 255, 0.8);
    padding-left: 1.5rem;
    line-height: 2;
  }

  .success-details ol li {
    margin-bottom: 0.5rem;
  }

  .success-details ol strong {
    color: white;
  }

  body.light-mode .success-details ol {
    color: #666;
  }

  body.light-mode .success-details ol strong {
    color: #1a1a1a;
  }

  .success-note {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 10px;
    padding: 1rem 1.5rem;
    margin-bottom: 2rem;
  }

  .success-note p {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    margin: 0;
  }

  body.light-mode .success-note {
    background: rgba(59, 130, 246, 0.08);
  }

  body.light-mode .success-note p {
    color: #555;
  }

  .back-home-btn {
    display: inline-block;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    text-decoration: none;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s;
  }

  .back-home-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
  }

  /* Responsive */
  @media (max-width: 900px) {
    .checkout-content {
      grid-template-columns: 1fr;
    }

    .order-summary-section {
      position: static;
      order: -1;
    }
  }

  @media (max-width: 600px) {
    .checkout-container {
      padding: 1rem;
    }

    .checkout-form-section,
    .order-summary-card {
      padding: 1.25rem;
    }

    .checkout-header h1 {
      font-size: 1.75rem;
    }

    .property-type-pills {
      flex-direction: column;
    }

    .pill-content {
      justify-content: flex-start;
      padding: 0.75rem 1rem;
    }

    .tenant-row {
      grid-template-columns: 1fr;
    }

    .form-row-2 {
      grid-template-columns: 1fr;
    }
  }

  /* ============================================
     WIZARD STYLES (All Screen Sizes)
     ============================================ */

  /* Hide mobile-only elements on desktop */
  .mobile-order-summary-toggle {
    display: none;
  }

  /* Progress Bar */
  .wizard-progress {
    display: block;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .wizard-progress-bar {
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 0.75rem;
  }

  body.light-mode .wizard-progress-bar {
    background: rgba(0, 0, 0, 0.1);
  }

  .wizard-progress-fill {
    height: 100%;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    border-radius: 2px;
    transition: width 0.3s ease-out;
    width: 33.33%;
  }

  .wizard-step-indicator {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-weight: 500;
  }

  body.light-mode .wizard-step-indicator {
    color: rgba(0, 0, 0, 0.6);
  }

  /* Hide all steps except the active one */
  .form-section[data-wizard-step] {
    display: none;
  }

  .form-section[data-wizard-step].wizard-active {
    display: block;
    animation: wizardFadeSlideIn 0.3s ease-out forwards;
  }

  .form-section[data-wizard-step].wizard-active-reverse {
    display: block;
    animation: wizardFadeSlideInReverse 0.3s ease-out forwards;
  }

  @keyframes wizardFadeSlideIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes wizardFadeSlideInReverse {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Hide terms checkbox on steps 1-2 */
  .checkbox-group {
    display: none;
  }

  .form-section[data-wizard-step="3"].wizard-active ~ .checkbox-group,
  .form-section[data-wizard-step="3"].wizard-active-reverse ~ .checkbox-group {
    display: block;
  }

  /* Wizard Navigation */
  .wizard-nav {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  body.light-mode .wizard-nav {
    border-top-color: rgba(0, 0, 0, 0.1);
  }

  .wizard-btn {
    flex: 1;
    padding: 1rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    min-height: 48px;
  }

  .wizard-btn-back {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: rgba(255, 255, 255, 0.9);
  }

  body.light-mode .wizard-btn-back {
    background: rgba(0, 0, 0, 0.03);
    border-color: rgba(0, 0, 0, 0.15);
    color: #333;
  }

  .wizard-btn-back:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .wizard-btn-back:not(:disabled):hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
  }

  .wizard-btn-next {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    border: none;
    color: white;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
  }

  .wizard-btn-next:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
  }

  .wizard-btn-submit {
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
  }

  .wizard-btn-submit:hover {
    box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
  }

  /* Shake animation for validation errors */
  @keyframes wizardShake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
    20%, 40%, 60%, 80% { transform: translateX(4px); }
  }

  .wizard-btn.shake {
    animation: wizardShake 0.5s ease-in-out;
  }

  /* Validation error styles */
  .form-group input.validation-error,
  .form-group select.validation-error,
  .property-address.validation-error {
    border-color: #e74c3c !important;
    background: rgba(231, 76, 60, 0.05) !important;
  }

  /* Desktop wizard layout adjustments */
  @media (min-width: 601px) {
    .wizard-nav {
      justify-content: flex-end;
    }

    .wizard-btn {
      flex: 0 0 auto;
      min-width: 140px;
    }

    .wizard-btn-back {
      min-width: 100px;
    }
  }

  /* Mobile-specific wizard styles */
  @media (max-width: 600px) {
    /* Mobile Order Summary - Fixed Bottom Bar */
    .mobile-order-summary-toggle {
      display: block;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(20, 20, 30, 0.98);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.light-mode .mobile-order-summary-toggle {
      background: rgba(255, 255, 255, 0.98);
      border-top-color: rgba(0, 0, 0, 0.1);
    }

    .mobile-summary-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      background: transparent;
      border: none;
      color: white;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }

    body.light-mode .mobile-summary-btn {
      color: #1a1a1a;
    }

    .mobile-summary-label {
      flex: 1;
      text-align: left;
    }

    .mobile-summary-total {
      color: #e74c3c;
      font-weight: 700;
      font-size: 1.1rem;
      margin-right: 0.75rem;
    }

    .mobile-summary-chevron {
      font-size: 0.75rem;
      transition: transform 0.3s ease;
    }

    .mobile-summary-btn[aria-expanded="true"] .mobile-summary-chevron {
      transform: rotate(180deg);
    }

    .mobile-summary-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s ease-out;
      padding: 0 1.25rem;
    }

    .mobile-summary-content.expanded {
      max-height: 300px;
      padding: 0 1.25rem 1rem;
    }

    /* Hide desktop order summary card on mobile */
    .order-summary-card {
      display: none;
    }

    /* Hide desktop submit button on mobile (wizard has its own) */
    .order-summary-section .submit-btn {
      display: none;
    }

    .order-summary-section .contact-help {
      display: none;
    }

    /* Add bottom padding to form to account for fixed summary */
    .checkout-form-section {
      padding-bottom: 80px;
    }

    /* Ensure order summary section doesn't affect layout on mobile */
    .order-summary-section {
      position: static;
      padding: 0;
      margin: 0;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .form-section[data-wizard-step].wizard-active,
    .form-section[data-wizard-step].wizard-active-reverse {
      animation: none;
    }

    .wizard-progress-fill {
      transition: none;
    }

    .wizard-btn.shake {
      animation: none;
    }
  }
</style>

<script is:inline>
  // Pricing configuration
  // Card prices include ~3% Square processing fee
  const PRICES_CARD = {
    apartment: 72.33,
    single_family: 103.20,
    multifamily: 170.09
  };

  // Zelle prices (no processing fee - 3% savings)
  const PRICES_ZELLE = {
    apartment: 70.00,
    single_family: 100.00,
    multifamily: 165.00
  };

  // Display prices for pills (rounded)
  const DISPLAY_PRICES_CARD = {
    apartment: 72,
    single_family: 103,
    multifamily: 170
  };

  const DISPLAY_PRICES_ZELLE = {
    apartment: 70,
    single_family: 100,
    multifamily: 165
  };

  const LABELS = {
    apartment: 'Apartment',
    single_family: 'Single Family Home',
    multifamily: 'Multifamily Home'
  };

  let propertyCount = 1;
  const maxProperties = 10;

  // Get current payment method
  function getPaymentMethod() {
    const paymentSelect = document.getElementById('payment-preference');
    return paymentSelect ? paymentSelect.value : 'card';
  }

  // Get prices based on payment method (default to Zelle/no-fee prices)
  function getCurrentPrices() {
    return getPaymentMethod() === 'card' ? PRICES_CARD : PRICES_ZELLE;
  }

  function getDisplayPrices() {
    return getPaymentMethod() === 'card' ? DISPLAY_PRICES_CARD : DISPLAY_PRICES_ZELLE;
  }

  // Update all pill prices displayed in the form
  function updatePillPrices() {
    const displayPrices = getDisplayPrices();
    document.querySelectorAll('.property-card').forEach(card => {
      const pills = card.querySelectorAll('.type-pill');
      pills.forEach(pill => {
        const input = pill.querySelector('input');
        const priceSpan = pill.querySelector('.pill-price');
        if (input && priceSpan) {
          const type = input.value;
          priceSpan.textContent = `$${displayPrices[type]}`;
        }
      });
    });
  }

  // Property card template
  function createPropertyCard(index) {
    const displayPrices = getDisplayPrices();
    return `
      <div class="property-card" data-property-index="${index}">
        <div class="property-card-header">
          <span class="property-number">Property ${index}</span>
          <button type="button" class="remove-property-btn" aria-label="Remove property">√ó</button>
        </div>

        <!-- Property Type Pills -->
        <div class="property-type-pills">
          <label class="type-pill">
            <input type="radio" name="property_${index}_type" value="apartment" required />
            <span class="pill-content">
              <span class="pill-icon">üè¢</span>
              <span class="pill-label">Apartment</span>
              <span class="pill-price">$${displayPrices.apartment}</span>
            </span>
          </label>
          <label class="type-pill">
            <input type="radio" name="property_${index}_type" value="single_family" checked />
            <span class="pill-content">
              <span class="pill-icon">üè†</span>
              <span class="pill-label">House</span>
              <span class="pill-price">$${displayPrices.single_family}</span>
            </span>
          </label>
          <label class="type-pill">
            <input type="radio" name="property_${index}_type" value="multifamily" />
            <span class="pill-content">
              <span class="pill-icon">üèòÔ∏è</span>
              <span class="pill-label">Multi</span>
              <span class="pill-price">$${displayPrices.multifamily}</span>
            </span>
          </label>
        </div>

        <!-- Address -->
        <input type="text" class="property-address" name="property_${index}_address" placeholder="Property address (e.g. 123 Main St, Tampa, FL)" required />

        <!-- Tenant Info Row -->
        <div class="tenant-row">
          <input type="text" name="property_${index}_tenant_name" placeholder="Tenant name" />
          <input type="tel" name="property_${index}_tenant_phone" placeholder="Tenant phone (for booking text)" />
        </div>
      </div>
    `;
  }

  // Update order summary
  function updateSummary() {
    const summaryItems = document.getElementById('summary-items');
    const summaryTotal = document.getElementById('summary-total');
    const hiddenTotal = document.getElementById('hidden-total');
    const prices = getCurrentPrices();

    let total = 0;
    const items = {};

    // Count properties by type
    document.querySelectorAll('.property-card').forEach(card => {
      const index = card.dataset.propertyIndex;
      const typeInput = card.querySelector(`input[name="property_${index}_type"]:checked`);
      if (typeInput) {
        const type = typeInput.value;
        items[type] = (items[type] || 0) + 1;
        total += prices[type];
      }
    });

    // Build summary HTML
    let html = '';
    for (const [type, count] of Object.entries(items)) {
      const subtotal = (prices[type] * count).toFixed(2);
      html += `
        <div class="summary-line-item">
          <span>${count}√ó ${LABELS[type]}</span>
          <span>$${subtotal}</span>
        </div>
      `;
    }

    summaryItems.innerHTML = html;
    summaryTotal.textContent = `$${total.toFixed(2)}`;
    hiddenTotal.value = `$${total.toFixed(2)}`;

    // Update pill prices when summary updates
    updatePillPrices();
  }

  // Update property numbers after removal
  function updatePropertyNumbers() {
    const cards = document.querySelectorAll('.property-card');
    cards.forEach((card, idx) => {
      const newIndex = idx + 1;
      card.dataset.propertyIndex = newIndex;
      card.querySelector('.property-number').textContent = `Property ${newIndex}`;

      // Update input names
      card.querySelectorAll('input, textarea').forEach(input => {
        const name = input.name;
        if (name) {
          input.name = name.replace(/property_\d+_/, `property_${newIndex}_`);
        }
      });

      // Show/hide remove button (hide for first property if it's the only one)
      const removeBtn = card.querySelector('.remove-property-btn');
      removeBtn.style.display = cards.length > 1 ? 'block' : 'none';
    });
    propertyCount = cards.length;
  }

  // Add property
  function addProperty() {
    console.log('addProperty called, current count:', propertyCount);
    if (propertyCount >= maxProperties) {
      alert(`Maximum ${maxProperties} properties allowed. Contact us for larger portfolios.`);
      return;
    }

    propertyCount++;
    const container = document.getElementById('properties-container');
    container.insertAdjacentHTML('beforeend', createPropertyCard(propertyCount));

    // Add event listeners to new card
    const newCard = container.lastElementChild;
    newCard.querySelector('.remove-property-btn').addEventListener('click', function() {
      newCard.remove();
      updatePropertyNumbers();
      updateSummary();
    });

    newCard.querySelectorAll('input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', updateSummary);
    });

    // Update remove button visibility
    updatePropertyNumbers();
    updateSummary();
  }

  // Initialize
  document.addEventListener('astro:page-load', () => {
    console.log('DOM loaded, initializing checkout form...');

    // Add property button
    const addBtn = document.getElementById('add-property-btn');
    console.log('Add property button found:', addBtn);
    if (addBtn) {
      addBtn.addEventListener('click', addProperty);
    }

    // Initial property type change listeners
    document.querySelectorAll('input[name="property_1_type"]').forEach(radio => {
      radio.addEventListener('change', updateSummary);
    });

    // Payment method change listener - updates prices
    document.getElementById('payment-preference').addEventListener('change', updateSummary);

    // Form submission - show success view
    document.getElementById('checkout-form').addEventListener('submit', function(e) {
      // Let form submit naturally to Formspree
      // After submission, Formspree will redirect back or we show success

      // For better UX, we'll use fetch and show success view
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          document.getElementById('form-view').style.display = 'none';
          document.getElementById('success-view').style.display = 'block';
          window.scrollTo(0, 0);
        } else {
          alert('There was an error submitting your request. Please try again or contact us directly.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('There was an error submitting your request. Please try again or contact us directly.');
      });
    });

    // Initial summary
    updateSummary();

    // ============================================
    // WIZARD FUNCTIONALITY (All Screen Sizes)
    // ============================================

    const WIZARD_CONFIG = {
      totalSteps: 3,
      currentStep: 1,
      isMobile: false
    };

    // Check if mobile (for mobile-specific features only)
    function checkIsMobile() {
      WIZARD_CONFIG.isMobile = window.matchMedia('(max-width: 600px)').matches;
      return WIZARD_CONFIG.isMobile;
    }

    // Initialize wizard on all screen sizes
    function initWizard() {
      checkIsMobile();

      setupWizardSteps();
      setupWizardNavigation();
      updateWizardUI();

      // Only setup mobile order summary on small screens
      if (WIZARD_CONFIG.isMobile) {
        setupMobileOrderSummary();
      }
    }

    // Setup wizard steps - show first step only
    function setupWizardSteps() {
      const steps = document.querySelectorAll('.form-section[data-wizard-step]');
      steps.forEach((step, index) => {
        step.classList.remove('wizard-active', 'wizard-active-reverse');
        if (index === 0) {
          step.classList.add('wizard-active');
        }
      });
      WIZARD_CONFIG.currentStep = 1;
    }

    // Show specific step with animation
    function showStep(stepNumber, direction = 'forward') {
      const currentStepEl = document.querySelector('.form-section[data-wizard-step].wizard-active, .form-section[data-wizard-step].wizard-active-reverse');
      const targetStepEl = document.querySelector(`[data-wizard-step="${stepNumber}"]`);

      if (!targetStepEl || targetStepEl === currentStepEl) return;

      // Remove classes from current step
      if (currentStepEl) {
        currentStepEl.classList.remove('wizard-active', 'wizard-active-reverse');
      }

      // Add appropriate animation class to new step
      const animationClass = direction === 'forward' ? 'wizard-active' : 'wizard-active-reverse';
      targetStepEl.classList.add(animationClass);

      // Update state
      WIZARD_CONFIG.currentStep = stepNumber;

      // Scroll to top of form
      const formSection = document.querySelector('.checkout-form-section');
      if (formSection) {
        formSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    // Setup navigation button listeners
    function setupWizardNavigation() {
      const backBtn = document.getElementById('wizard-back-btn');
      const nextBtn = document.getElementById('wizard-next-btn');

      if (!backBtn || !nextBtn) return;

      backBtn.addEventListener('click', goToPreviousStep);
      nextBtn.addEventListener('click', goToNextStep);
    }

    // Go to previous step
    function goToPreviousStep() {
      if (WIZARD_CONFIG.currentStep <= 1) return;

      showStep(WIZARD_CONFIG.currentStep - 1, 'backward');
      updateWizardUI();
    }

    // Go to next step or submit
    function goToNextStep() {
      // Validate current step first
      if (!validateCurrentStep()) {
        shakeNextButton();
        return;
      }

      if (WIZARD_CONFIG.currentStep >= WIZARD_CONFIG.totalSteps) {
        // Submit the form
        submitWizardForm();
        return;
      }

      showStep(WIZARD_CONFIG.currentStep + 1, 'forward');
      updateWizardUI();
    }

    // Validate current step
    function validateCurrentStep() {
      const currentStepEl = document.querySelector(`[data-wizard-step="${WIZARD_CONFIG.currentStep}"]`);
      if (!currentStepEl) return true;

      let isValid = true;
      let firstInvalidField = null;

      // Clear previous validation states
      currentStepEl.querySelectorAll('.validation-error').forEach(el => {
        el.classList.remove('validation-error');
      });

      // Check required text/email/tel/select inputs
      const requiredInputs = currentStepEl.querySelectorAll('input[required]:not([type="radio"]):not([type="checkbox"]), select[required], textarea[required]');
      requiredInputs.forEach(field => {
        if (!field.value.trim() || !field.checkValidity()) {
          isValid = false;
          field.classList.add('validation-error');
          if (!firstInvalidField) firstInvalidField = field;
        }
      });

      // Check required radio buttons (property type) in step 2
      if (WIZARD_CONFIG.currentStep === 2) {
        const propertyCards = currentStepEl.querySelectorAll('.property-card');
        propertyCards.forEach(card => {
          const index = card.dataset.propertyIndex;
          const radioGroup = card.querySelectorAll(`input[name="property_${index}_type"]`);
          const anyChecked = Array.from(radioGroup).some(r => r.checked);
          if (!anyChecked && radioGroup.length > 0) {
            isValid = false;
            // Highlight the pills container
            const pillsContainer = card.querySelector('.property-type-pills');
            if (pillsContainer) pillsContainer.classList.add('validation-error');
          }

          // Check required address
          const addressInput = card.querySelector('.property-address');
          if (addressInput && !addressInput.value.trim()) {
            isValid = false;
            addressInput.classList.add('validation-error');
            if (!firstInvalidField) firstInvalidField = addressInput;
          }
        });
      }

      // Step 3: Also validate terms checkbox
      if (WIZARD_CONFIG.currentStep === 3) {
        const termsCheckbox = document.getElementById('terms');
        if (termsCheckbox && !termsCheckbox.checked) {
          isValid = false;
          if (!firstInvalidField) firstInvalidField = termsCheckbox;
        }
      }

      // Focus first invalid field
      if (firstInvalidField) {
        firstInvalidField.focus();
      }

      return isValid;
    }

    // Shake the next button on validation error
    function shakeNextButton() {
      const nextBtn = document.getElementById('wizard-next-btn');
      if (!nextBtn) return;

      nextBtn.classList.add('shake');
      setTimeout(() => {
        nextBtn.classList.remove('shake');
      }, 500);
    }

    // Update all wizard UI elements
    function updateWizardUI() {
      updateProgressBar();
      updateStepIndicator();
      updateNavigationButtons();
      updateMobileSummaryTotal();
    }

    // Update progress bar width
    function updateProgressBar() {
      const progressFill = document.getElementById('wizard-progress-fill');
      if (!progressFill) return;

      const percentage = (WIZARD_CONFIG.currentStep / WIZARD_CONFIG.totalSteps) * 100;
      progressFill.style.width = `${percentage}%`;
    }

    // Update step indicator text
    function updateStepIndicator() {
      const stepIndicator = document.getElementById('wizard-current-step');
      if (!stepIndicator) return;

      stepIndicator.textContent = WIZARD_CONFIG.currentStep;
    }

    // Update navigation buttons state
    function updateNavigationButtons() {
      const backBtn = document.getElementById('wizard-back-btn');
      const nextBtn = document.getElementById('wizard-next-btn');

      if (!backBtn || !nextBtn) return;

      // Back button state
      backBtn.disabled = WIZARD_CONFIG.currentStep <= 1;

      // Next button state and text
      if (WIZARD_CONFIG.currentStep >= WIZARD_CONFIG.totalSteps) {
        nextBtn.textContent = 'Submit Inquiry';
        nextBtn.classList.add('wizard-btn-submit');
        nextBtn.classList.remove('wizard-btn-next');
      } else {
        nextBtn.textContent = 'Next';
        nextBtn.classList.remove('wizard-btn-submit');
        nextBtn.classList.add('wizard-btn-next');
      }
    }

    // Update mobile summary total
    function updateMobileSummaryTotal() {
      const summaryTotal = document.getElementById('summary-total');
      const mobileSummaryTotal = document.getElementById('mobile-summary-total');

      if (summaryTotal && mobileSummaryTotal) {
        mobileSummaryTotal.textContent = summaryTotal.textContent;
      }

      // Also update mobile summary content
      const desktopSummaryItems = document.getElementById('summary-items');
      const mobileSummaryContent = document.getElementById('mobile-summary-content');
      if (desktopSummaryItems && mobileSummaryContent) {
        mobileSummaryContent.innerHTML = desktopSummaryItems.innerHTML;
      }
    }

    // Setup mobile order summary toggle
    function setupMobileOrderSummary() {
      const toggleBtn = document.getElementById('toggle-summary-btn');
      const summaryContent = document.getElementById('mobile-summary-content');

      if (!toggleBtn || !summaryContent) return;

      toggleBtn.addEventListener('click', () => {
        const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
        toggleBtn.setAttribute('aria-expanded', !isExpanded);
        summaryContent.classList.toggle('expanded', !isExpanded);
      });

      // Initial content sync
      updateMobileSummaryTotal();
    }

    // Submit form via wizard
    function submitWizardForm() {
      const form = document.getElementById('checkout-form');
      if (!form) return;

      // Trigger the existing form submission
      form.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
    }

    // Initialize wizard on all screen sizes
    initWizard();

    // Handle resize - toggle mobile summary, wizard stays active
    let wizardResizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(wizardResizeTimeout);
      wizardResizeTimeout = setTimeout(() => {
        const wasMobile = WIZARD_CONFIG.isMobile;
        const isMobileNow = checkIsMobile();

        // If switching to mobile, setup mobile summary
        if (!wasMobile && isMobileNow) {
          setupMobileOrderSummary();
          updateMobileSummaryTotal();
        }
      }, 150);
    });

    // Update mobile summary when order summary updates
    const summaryObserver = new MutationObserver(() => {
      if (WIZARD_CONFIG.isMobile) {
        updateMobileSummaryTotal();
      }
    });

    const summaryItemsEl = document.getElementById('summary-items');
    if (summaryItemsEl) {
      summaryObserver.observe(summaryItemsEl, { childList: true, subtree: true, characterData: true });
    }
  });
</script>
